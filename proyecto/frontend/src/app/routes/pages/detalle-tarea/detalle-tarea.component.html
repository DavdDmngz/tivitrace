<div class="d-flex">
    <!-- Contenido principal -->
    <div class="container-fluid">
      <!-- Título de la página -->
      <div class="d-flex justify-content-between align-items-center mb-4" *ngIf="tarea">
        <h1 class="h3 mb-0 text-gray-800">Tarea: {{ tarea.nombre }}</h1>
        <button class="btn btn-primary">
          <i class="fas fa-arrow-left"></i> Volver
        </button>
      </div>
      
      <!-- Si tarea no está definida, muestra un mensaje de carga -->
      <div *ngIf="!tarea" class="mb-4">
        <p>Cargando tarea...</p>
      </div>
  
      <!-- Información básica -->
      <div *ngIf="tarea" class="card shadow-sm mb-3">
        <div class="card-body">
          <form>
            <div class="form-group mb-2">
              <label>Nombre</label>
              <input type="text" class="form-control" [(ngModel)]="tarea.nombre" name="nombre">
            </div>
  
            <div class="form-group mb-2">
              <label>Estado</label>
              <select class="form-control" [(ngModel)]="tarea.estado" name="estado">
                <option *ngFor="let estado of estados" [value]="estado">{{ estado }}</option>
              </select>
            </div>
          </form>
        </div>
      </div>
  
      <!-- Descripción + Archivos -->
      <div *ngIf="tarea" class="card shadow-sm mb-3">
        <div class="card-body">
          <label class="mb-2">Descripción</label>
          <textarea
            class="form-control mb-3"
            rows="4"
            [(ngModel)]="tarea.descripcion"
            name="descripcion"
            [placeholder]="!tarea.descripcion ? 'Agrega una descripción' : ''"
          ></textarea>
  
          <label class="mb-2">Archivos Adjuntos</label>
          <input type="file" (change)="onArchivoSeleccionado($event)" multiple class="form-control mb-3">
  
          <ul class="list-group">
            <li *ngFor="let archivo of archivosAdjuntos; let i = index"
                class="list-group-item d-flex justify-content-between align-items-center">
              {{ archivo.name }}
              <button class="btn btn-sm btn-danger" (click)="eliminarArchivo(i)">
                <i class="fas fa-times"></i>
              </button>
            </li>
          </ul>
        </div>
      </div>
  
      <!-- Participantes -->
      <div *ngIf="tarea" class="card shadow-sm">
        <div class="card-header py-2">
          <h6 class="m-0 font-weight-bold text-primary">Participantes</h6>
        </div>
        <div class="card-body">
          <ul class="list-group" *ngIf="participantes.length > 0; else noParticipantes">
            <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let p of participantes">
              {{ p }}
              <button class="btn btn-sm btn-danger" (click)="eliminarParticipante(p)">
                <i class="fas fa-user-minus"></i>
              </button>
            </li>
          </ul>
          <ng-template #noParticipantes>
            <p class="text-muted">Agrega usuarios.</p>
          </ng-template>
        </div>
      </div>
    </div>
  
    <!-- Sidebar de acciones a la derecha -->
    <div class="d-flex flex-column align-items-center bg-light p-2 shadow-sm"
        style="width: 60px; height: calc(100vh - 56px); position: relative; right: 0; top: 56px; z-index: 1030;">
      <button class="btn btn-sm btn-outline-success mb-3" (click)="guardarCambios()" title="Guardar">
        <i class="fas fa-save"></i>
      </button>
      <button class="btn btn-sm btn-outline-primary mb-3" data-toggle="modal" data-target="#agregarParticipanteModal" title="Agregar participante">
        <i class="fas fa-user-plus"></i>
      </button>
      <button class="btn btn-sm btn-outline-danger mb-3" (click)="eliminarTarea()" title="Eliminar tarea">
        <i class="fas fa-trash-alt"></i>
      </button>
      <button class="btn btn-sm btn-outline-warning" (click)="confirmarFinalizar()" title="Finalizar tarea">
        <i class="fas fa-check-circle"></i>
      </button>
    </div>
  </div>
  
  <!-- Modal para agregar participantes -->
  <div class="modal fade" id="agregarParticipanteModal" tabindex="-1" role="dialog" aria-labelledby="agregarParticipanteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="agregarParticipanteModalLabel">Agregar Participante</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <input type="text" [(ngModel)]="nuevoParticipante" class="form-control mb-2"
                 (input)="buscarUsuarios()" placeholder="Nombre del participante">
  
          <!-- Lista de sugerencias -->
          <ul class="list-group" *ngIf="usuariosFiltrados.length > 0">
            <li *ngFor="let usuario of usuariosFiltrados"
                (click)="seleccionarUsuario(usuario)"
                class="list-group-item list-group-item-action"
                style="cursor: pointer;">
              {{ usuario.nombre }} {{ usuario.apellido }} ({{ usuario.correo }})
            </li>
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-primary" (click)="agregarParticipante()" [disabled]="!usuarioSeleccionado">Agregar</button>
        </div>
      </div>
    </div>
  </div>
  